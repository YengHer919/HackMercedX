<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wallet Tracker</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    
    .container {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      width: 100%;
      max-width: 800px;
      padding: 2rem;
    }
    
    .form-container {
      display: flex;
      flex-direction: column;
    }
    
    h1 {
      color: #333;
      text-align: center;
      margin-bottom: 1.5rem;
    }
    
    .tabs {
      display: flex;
      margin-bottom: 1.5rem;
    }
    
    .tab {
      flex: 1;
      text-align: center;
      padding: 0.75rem;
      cursor: pointer;
      border-bottom: 2px solid #ddd;
      transition: all 0.3s ease;
    }
    
    .tab.active {
      border-bottom: 2px solid #4285f4;
      color: #4285f4;
      font-weight: bold;
    }
    
    .form-group {
      margin-bottom: 1rem;
    }
    
    label {
      display: block;
      margin-bottom: 0.5rem;
      color: #555;
    }
    
    input {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 1rem;
    }
    
    button {
      width: 100%;
      padding: 0.75rem;
      background-color: #4285f4;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-top: 1rem;
    }
    
    button:hover {
      background-color: #3367d6;
    }
    
    .error-message {
      color: #d93025;
      margin-top: 1rem;
      text-align: center;
    }
    
    .success-message {
      color: #34a853;
      margin-top: 1rem;
      text-align: center;
    }

    .hidden {
      display: none;
    }

    .welcome-container {
      text-align: center;
    }

    .logout-btn {
      background-color: #f44336;
      margin-top: 2rem;
    }

    .logout-btn:hover {
      background-color: #d32f2f;
    }
    
    .wallet-card {
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 1rem;
      margin-bottom: 1rem;
      position: relative;
    }
    
    .wallet-name {
      font-weight: bold;
      margin-bottom: 0.5rem;
    }
    
    .wallet-balance {
      color: #34a853;
    }
    
    .transaction {
      border-bottom: 1px solid #eee;
      padding: 0.75rem 0;
    }
    
    .transaction-date {
      font-size: 0.8rem;
      color: #777;
    }
    
    .transaction-amount {
      float: right;
    }
    
    .expense {
      color: #d93025;
    }
    
    .income {
      color: #34a853;
    }
    
    .wallet-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }
    
    .wallet-actions button {
      flex: 1;
      margin-top: 0.5rem;
      padding: 0.5rem;
    }
    
    .delete-wallet {
      background-color: #f44336;
    }
    
    .delete-wallet:hover {
      background-color: #d32f2f;
    }
    
    .add-transaction {
      margin-top: 1rem;
    }
    
    .no-wallets {
      text-align: center;
      color: #777;
      margin: 2rem 0;
    }
    
    .current-wallet {
      text-align: center;
      font-weight: bold;
      margin-bottom: 1rem;
      color: #4285f4;
    }
    
    .add-transaction-form {
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid #eee;
    }
    
    .radio-group {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    
    .radio-option {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }
    
    .select-wallet {
      background-color: #4caf50;
    }
    
    .select-wallet:hover {
      background-color: #43a047;
    }

    .stock-card {
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 1rem;
      margin: 1rem 0;
      background-color: #f9f9f9;
    }

    .stock-price, .stock-high, .stock-low {
      font-weight: bold;
    }

    .stock-change-positive {
      color: #34a853;
    }

    .stock-change-negative {
      color: #d93025;
    }

    #watchlist {
      margin-top: 1rem;
    }

    .watchlist-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem;
      border-bottom: 1px solid #eee;
    }

    .watchlist-symbol {
      font-weight: bold;
    }

    .watchlist-price {
      color: #333;
    }

    .watchlist-change {
      min-width: 80px;
      text-align: right;
    }

    .remove-from-watchlist {
      background-color: #f44336;
      padding: 0.25rem 0.5rem;
      margin: 0;
    }

  /* Layout for the dashboard */
  .dashboard-container {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }
  
  /* For larger screens, make it a two-column layout */
  @media (min-width: 768px) {
    .dashboard-container {
      flex-direction: row;
    }
    
    .dashboard-section {
      flex: 1;
    }
    
    #activity-section {
      margin-right: 1rem;
    }
    
    #stocks-section {
      margin-left: 1rem;
    }
  }
  
  /* Section styling */
  .dashboard-section {
    background-color: #f9f9f9;
    border-radius: 8px;
    padding: 1rem;
  }
  
  .dashboard-section h2 {
    margin-top: 0;
    color: #4285f4;
    font-size: 1.5rem;
    margin-bottom: 1rem;
  }
</style>
</head>
<body>
  <div class="container" id="app-container">
    <h1>Wallet Tracker</h1>
    
    <div class="tabs">
      <div class="tab active" id="tab-dashboard">Dashboard</div>
      <div class="tab" id="tab-wallets">Wallets</div>
    </div>
    
    <!-- Dashboard Page (combines Activity and Stocks) -->
    <div class="page" id="dashboard-page">
      <div class="dashboard-container">
        <!-- Activity Section -->
        <div class="dashboard-section" id="activity-section">
          <h2>Activity</h2>
          <div id="no-wallet-selected" class="welcome-container hidden">
            <p>No wallet selected. Please select a wallet from the Wallets tab.</p>
            <button id="go-to-wallets">Go to Wallets</button>
          </div>
          
          <div id="wallet-details" class="hidden">
            <div class="current-wallet">Current Wallet: <span id="current-wallet-name"></span></div>
            <div class="wallet-balance">Balance: $<span id="current-wallet-balance"></span></div>
            
            <h3>Recent Transactions</h3>
            <div id="transactions-list">
              <!-- Transactions will be added here dynamically -->
            </div>
          </div>
        </div>

        <!-- Stocks Section -->
        <div class="dashboard-section" id="stocks-section">
          <h2>Stocks</h2>
          <div class="form-group">
            <label for="stock-symbol">Stock Symbol</label>
            <input type="text" id="stock-symbol" placeholder="Enter stock symbol (e.g., AAPL)">
          </div>
          
          <button id="search-stock-btn">Search</button>
          
          <div id="stock-result" class="hidden">
            <div class="stock-card">
              <h3 id="stock-name">Company Name</h3>
              <div class="stock-price">Current Price: $<span id="stock-price-value"></span></div>
              <div class="stock-change">Change: <span id="stock-change-value"></span></div>
              <div class="stock-volume">Volume: <span id="stock-volume-value"></span></div>
              <div class="stock-high">High: $<span id="stock-high-value"></span></div>
              <div class="stock-low">Low: $<span id="stock-low-value"></span></div>
              <div class="stock-pe">P/E Ratio: <span id="stock-pe-value"></span></div>
              <div class="stock-dividend">Dividend Yield: <span id="stock-dividend-value"></span>%</div>
              <div class="stock-market-cap">Market Cap: $<span id="stock-market-cap-value"></span></div>
            </div>
            
            <button id="add-to-watchlist-btn" class="select-wallet">Add to Watchlist</button>
          </div>
          
          <div id="stock-error" class="error-message hidden">
            Could not find stock information. Please check the symbol and try again.
          </div>
          
          <div id="stock-loading" class="hidden">
            <p>Loading stock information...</p>
          </div>
          
          <h3>Watchlist</h3>
          <div id="watchlist">
            <!-- Watchlist stocks will be added here -->
          </div>
        </div>
      </div>
    </div>

    
    <!-- Wallets Page -->
    <div class="page hidden" id="wallets-page">
      <div id="wallets-list">
        <!-- Wallets will be added here dynamically -->
      </div>
      
      <div id="no-wallets" class="hidden">
        <p>You don't have any wallets yet. Add one below!</p>
      </div>
      
      <div class="form-group">
        <label for="new-wallet-name">Add New Wallet</label>
        <input type="text" id="new-wallet-name" placeholder="Enter wallet name">
      </div>
      
      <div class="form-group">
        <label for="initial-balance">Initial Balance ($)</label>
        <input type="number" id="initial-balance" placeholder="Enter initial balance" value="0">
      </div>
      
      <button id="add-wallet-btn">Add Wallet</button>
    </div>
  </div>

  <script>
    // App state
    let wallets = JSON.parse(localStorage.getItem('wallets')) || [];
    let currentWalletId = localStorage.getItem('currentWalletId') || null;
    let watchlist = JSON.parse(localStorage.getItem('watchlist')) || [];
    const apiKey = 'YOUR_ALPHA_VANTAGE_API_KEY'; // Replace with your actual API key

    // DOM Elements
    const tabDashboard = document.getElementById('tab-dashboard');
    const tabWallets = document.getElementById('tab-wallets');
    const dashboardPage = document.getElementById('dashboard-page');
    const walletsPage = document.getElementById('wallets-page');
    const noWalletSelected = document.getElementById('no-wallet-selected');
    const walletDetails = document.getElementById('wallet-details');
    const currentWalletName = document.getElementById('current-wallet-name');
    const currentWalletBalance = document.getElementById('current-wallet-balance');
    const transactionsList = document.getElementById('transactions-list');
    const walletsList = document.getElementById('wallets-list');
    const noWallets = document.getElementById('no-wallets');
    const newWalletName = document.getElementById('new-wallet-name');
    const initialBalance = document.getElementById('initial-balance');
    const addWalletBtn = document.getElementById('add-wallet-btn');
    const goToWalletsBtn = document.getElementById('go-to-wallets');
    const stockSymbolInput = document.getElementById('stock-symbol');
    const searchStockBtn = document.getElementById('search-stock-btn');
    const stockResult = document.getElementById('stock-result');
    const stockError = document.getElementById('stock-error');
    const stockLoading = document.getElementById('stock-loading');
    const stockName = document.getElementById('stock-name');
    const stockPriceValue = document.getElementById('stock-price-value');
    const stockChangeValue = document.getElementById('stock-change-value');
    const stockVolumeValue = document.getElementById('stock-volume-value');
    const stockHighValue = document.getElementById('stock-high-value');
    const stockLowValue = document.getElementById('stock-low-value');
    const stockPeValue = document.getElementById('stock-pe-value');
    const stockDividendValue = document.getElementById('stock-dividend-value');
    const stockMarketCapValue = document.getElementById('stock-market-cap-value');
    const addToWatchlistBtn = document.getElementById('add-to-watchlist-btn');
    const watchlistElement = document.getElementById('watchlist');

    // Helper Functions
    function saveWallets() {
      localStorage.setItem('wallets', JSON.stringify(wallets));
    }
    
    function saveCurrentWalletId() {
      localStorage.setItem('currentWalletId', currentWalletId);
    }
    
    function saveWatchlist() {
      localStorage.setItem('watchlist', JSON.stringify(watchlist));
    }
    
    function formatDate(date) {
      return new Date(date).toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
      });
    }
    
    function getWalletById(id) {
      return wallets.find(wallet => wallet.id === id);
    }
    
    function generateId() {
      return Math.random().toString(36).substr(2, 9);
    }
    
    // UI Functions
    function showTab(tabName) {
      // Hide all pages
      dashboardPage.classList.add('hidden');
      walletsPage.classList.add('hidden');
      
      // Remove active class from tabs
      tabDashboard.classList.remove('active');
      tabWallets.classList.remove('active');
      
      // Show selected page and activate tab
      if (tabName === 'dashboard') {
        dashboardPage.classList.remove('hidden');
        tabDashboard.classList.add('active');
        updateActivitySection();
        updateWatchlist();
      } else if (tabName === 'wallets') {
        walletsPage.classList.remove('hidden');
        tabWallets.classList.add('active');
        updateWalletsPage();
      }
    }
    
    function updateActivitySection() {
      if (!currentWalletId || !getWalletById(currentWalletId)) {
        noWalletSelected.classList.remove('hidden');
        walletDetails.classList.add('hidden');
        return;
      }
      const wallet = getWalletById(currentWalletId);
      
      noWalletSelected.classList.add('hidden');
      walletDetails.classList.remove('hidden');
      
      currentWalletName.textContent = wallet.name;
      currentWalletBalance.textContent = wallet.balance.toFixed(2);
      
      // Update transactions list
      transactionsList.innerHTML = '';
      
      if (wallet.transactions.length === 0) {
        transactionsList.innerHTML = '<p>No transactions yet.</p>';
      } else {
        wallet.transactions.sort((a, b) => b.date - a.date).forEach(transaction => {
          const transactionEl = document.createElement('div');
          transactionEl.className = 'transaction';
          
          const amountClass = transaction.type === 'expense' ? 'expense' : 'income';
          const amountPrefix = transaction.type === 'expense' ? '-' : '+';
          
          transactionEl.innerHTML = `
            <div class="transaction-description">${transaction.description}</div>
            <div class="transaction-date">${formatDate(transaction.date)}</div>
            <div class="transaction-amount ${amountClass}">${amountPrefix}$${transaction.amount.toFixed(2)}</div>
          `;
          
          transactionsList.appendChild(transactionEl);
        });
      }
    }
    
    function updateWalletsPage() {
      walletsList.innerHTML = '';
      
      if (wallets.length === 0) {
        noWallets.classList.remove('hidden');
      } else {
        noWallets.classList.add('hidden');
        
        wallets.forEach(wallet => {
          const walletEl = document.createElement('div');
          walletEl.className = 'wallet-card';
          
          walletEl.innerHTML = `
            <div class="wallet-name">${wallet.name}</div>
            <div class="wallet-balance">Balance: $${wallet.balance.toFixed(2)}</div>
            <div class="wallet-transactions">Transactions: ${wallet.transactions.length}</div>
            <div class="wallet-actions">
              <button class="select-wallet" data-id="${wallet.id}">Select</button>
              <button class="delete-wallet" data-id="${wallet.id}">Delete</button>
            </div>
          `;
          
          walletsList.appendChild(walletEl);
        });
        
        // Add event listeners for wallet buttons
        document.querySelectorAll('.select-wallet').forEach(button => {
          button.addEventListener('click', function() {
            currentWalletId = this.getAttribute('data-id');
            saveCurrentWalletId();
            showTab('dashboard');
          });
        });
        
        document.querySelectorAll('.delete-wallet').forEach(button => {
          button.addEventListener('click', function() {
            const id = this.getAttribute('data-id');
            if (confirm('Are you sure you want to delete this wallet?')) {
              wallets = wallets.filter(wallet => wallet.id !== id);
              saveWallets();
              
              if (currentWalletId === id) {
                currentWalletId = wallets.length > 0 ? wallets[0].id : null;
                saveCurrentWalletId();
              }
              
              updateWalletsPage();
            }
          });
        });
      }
    }
    
    // Event Listeners
    tabWallets.addEventListener('click', () => showTab('wallets'));
    tabDashboard.addEventListener('click', () => showTab('dashboard'));
    goToWalletsBtn.addEventListener('click', () => showTab('wallets'));
    
    searchStockBtn.addEventListener('click', () => {
      const symbol = stockSymbolInput.value.trim().toUpperCase();
      if (symbol) {
        fetchStockData(symbol);
      } else {
        alert('Please enter a stock symbol');
      }
    });

    addToWatchlistBtn.addEventListener('click', () => {
      const symbol = stockResult.dataset.symbol;
      const price = stockResult.dataset.price;
      const change = stockResult.dataset.change;
      const changeValue = stockResult.dataset.changeValue;
      
      // Check if stock is already in watchlist
      if (!watchlist.some(stock => stock.symbol === symbol)) {
        watchlist.push({
          symbol,
          price,
          change,
          changeValue,
          addedAt: Date.now()
        });
        
        saveWatchlist();
        updateWatchlist();
      } else {
        alert('This stock is already in your watchlist');
      }
    });

    addWalletBtn.addEventListener('click', () => {
      const name = newWalletName.value.trim();
      const balance = parseFloat(initialBalance.value) || 0;
      
      if (!name) {
        alert('Please enter a wallet name');
        return;
      }
      
      const newWallet = {
        id: generateId(),
        name,
        balance,
        transactions: []
      };
      
      wallets.push(newWallet);
      saveWallets();
      
      if (!currentWalletId) {
        currentWalletId = newWallet.id;
        saveCurrentWalletId();
      }
      
      newWalletName.value = '';
      initialBalance.value = '0';
      
      updateWalletsPage();
    });
    
    // Function to fetch stock data from Alpha Vantage
    async function fetchStockData(symbol) {
      stockResult.classList.add('hidden');
      stockError.classList.add('hidden');
      stockLoading.classList.remove('hidden');
      
      try {
        // Global Quote endpoint
        const quoteResponse = await fetch(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${symbol}&apikey=${apiKey}`);
        const quoteData = await quoteResponse.json();
        
        // Overview endpoint for additional information
        const overviewResponse = await fetch(`https://www.alphavantage.co/query?function=OVERVIEW&symbol=${symbol}&apikey=${apiKey}`);
        const overviewData = await overviewResponse.json();
        
        if (quoteData['Error Message'] || !quoteData['Global Quote'] || !quoteData['Global Quote']['05. price']) {
          throw new Error('Invalid stock symbol');
        }
        
        displayStockData(symbol, quoteData, overviewData);
        stockLoading.classList.add('hidden');
        stockResult.classList.remove('hidden');
      } catch (error) {
        console.error('Error fetching stock data:', error);
        stockLoading.classList.add('hidden');
        stockError.classList.remove('hidden');
      }
    }

    // Function to display stock data
    function displayStockData(symbol, quoteData, overviewData) {
      const quote = quoteData['Global Quote'];
      
      // Basic quote data
      const price = parseFloat(quote['05. price']).toFixed(2);
      const change = parseFloat(quote['09. change']).toFixed(2);
      const changePercent = quote['10. change percent'].replace('%', '');
      const volume = parseInt(quote['06. volume']).toLocaleString();
      
      // Display basic data
      stockName.textContent = overviewData.Name || symbol;
      stockPriceValue.textContent = price;
      
      const changeText = `${change > 0 ? '+' : ''}${change} (${changePercent}%)`;
      stockChangeValue.textContent = changeText;
      stockChangeValue.className = change >= 0 ? 'stock-change-positive' : 'stock-change-negative';
      
      stockVolumeValue.textContent = volume;
      stockHighValue.textContent = parseFloat(quote['03. high']).toFixed(2);
      stockLowValue.textContent = parseFloat(quote['04. low']).toFixed(2);
      
      // Display additional data from overview
      if (overviewData.PERatio) {
        stockPeValue.textContent = parseFloat(overviewData.PERatio).toFixed(2);
      } else {
        stockPeValue.textContent = 'N/A';
      }
      
      if (overviewData.DividendYield) {
        stockDividendValue.textContent = (parseFloat(overviewData.DividendYield) * 100).toFixed(2);
      } else {
        stockDividendValue.textContent = 'N/A';
      }
      
      if (overviewData.MarketCapitalization) {
        const marketCap = parseInt(overviewData.MarketCapitalization);
        stockMarketCapValue.textContent = formatMarketCap(marketCap);
      } else {
        stockMarketCapValue.textContent = 'N/A';
      }
      
      // Store current stock data for adding to watchlist
      stockResult.dataset.symbol = symbol;
      stockResult.dataset.price = price;
      stockResult.dataset.change = changeText;
      stockResult.dataset.changeValue = change;
    }

    // Helper function to format market cap
    function formatMarketCap(value) {
      if (value >= 1e12) {
        return (value / 1e12).toFixed(2) + 'T';
      } else if (value >= 1e9) {
        return (value / 1e9).toFixed(2) + 'B';
      } else if (value >= 1e6) {
        return (value / 1e6).toFixed(2) + 'M';
      } else {
        return value.toLocaleString();
      }
    }

    // Function to update watchlist display
    function updateWatchlist() {
      watchlistElement.innerHTML = '';
      
      if (watchlist.length === 0) {
        watchlistElement.innerHTML = '<p>No stocks in your watchlist yet.</p>';
        return;
      }
      
      watchlist.forEach(stock => {
        const watchlistItem = document.createElement('div');
        watchlistItem.className = 'watchlist-item';
        
        watchlistItem.innerHTML = `
          <div class="watchlist-symbol">${stock.symbol}</div>
          <div class="watchlist-price">$${stock.price}</div>
          <div class="watchlist-change ${stock.changeValue >= 0 ? 'stock-change-positive' : 'stock-change-negative'}">${stock.change}</div>
          <button class="remove-from-watchlist" data-symbol="${stock.symbol}">X</button>
        `;
        
        watchlistElement.appendChild(watchlistItem);
      });
      
      // Add event listeners for remove buttons
      document.querySelectorAll('.remove-from-watchlist').forEach(button => {
        button.addEventListener('click', function() {
          const symbol = this.getAttribute('data-symbol');
          watchlist = watchlist.filter(stock => stock.symbol !== symbol);
          saveWatchlist();
          updateWatchlist();
        });
      });
    }

    // Function to refresh watchlist data
    async function refreshWatchlist() {
      if (watchlist.length === 0) return;
      
      // Limit API calls by updating one stock at a time
      const stockToUpdate = watchlist[0];
      watchlist = watchlist.slice(1).concat([stockToUpdate]);
      
      try {
        const response = await fetch(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${stockToUpdate.symbol}&apikey=${apiKey}`);
        const data = await response.json();
        
        if (data['Global Quote'] && data['Global Quote']['05. price']) {
          const quote = data['Global Quote'];
          const price = parseFloat(quote['05. price']).toFixed(2);
          const change = parseFloat(quote['09. change']).toFixed(2);
          const changePercent = quote['10. change percent'].replace('%', '');
          const changeText = `${change > 0 ? '+' : ''}${change} (${changePercent}%)`;
          
          // Update the stock in the watchlist
          const index = watchlist.findIndex(stock => stock.symbol === stockToUpdate.symbol);
          if (index !== -1) {
            watchlist[index].price = price;
            watchlist[index].change = changeText;
            watchlist[index].changeValue = change;
            saveWatchlist();
            updateWatchlist();
          }
        }
      } catch (error) {
        console.error('Error refreshing watchlist:', error);
      }
    }

    // Set up a periodic refresh
    setInterval(refreshWatchlist, 60000); // Update every minute

    // Initialize
    function init() {
      // Show initial tab
      if (currentWalletId && getWalletById(currentWalletId)) {
        showTab('dashboard');
      } else {
        showTab('wallets');
      }
    }
    
    init();
  </script>
</body>
</html>
